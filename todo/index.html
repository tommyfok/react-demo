<!DOCTYPE html>
<html>
<head>
    <title>Tommy's Todo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style/main.css">
</head>
<body>
    <header>Tommy's Todo</h1></header>
    <section id="todo-list"></section>
    <footer>Tommy's Todo List, powered by React.</footer>
</body>
<script src="js/react.js"></script>
<script src="js/JSXTransformer.js"></script>
<script type="text/jsx">
var TodoItem = React.createClass({
  getInitialState: function () {
    return {isRemoved: false};
  },
  remove: function () {
    if (this.state.isRemoved === false) {
      this.props.remove.call(this, this.props.index);
      this.state.isRemoved = true;
    }
  },
  render: function () {
    // JSX中的Event名称和原生JS有所区别
    // 参考http://facebook.github.io/react/docs/events.html
    return (
      <li style={{cursor:'pointer'}}>
        <a>{this.props.content}</a>
        <span className={'del'} onTouchEnd={this.remove} onClick={this.remove}>删</span>
      </li>
    );
  }
});

var TodoList = React.createClass({
  getInitialState: function() {
    var data = localStorage.getItem('tomToDo') || '';
    if (data) {
      var data = data.split('_ttd#');
    } else {
      data = [];
    }
    return {
      data: data
    };
  },
  add: function (item) {
    this.state.data.push(item);
    localStorage.setItem('tomToDo', this.state.data.join('_ttd#'));
    this.setState({data: this.state.data});
  },
  remove: function (index) {
    this.state.data.splice(index, 1);
    localStorage.setItem('tomToDo', this.state.data.join('_ttd#'));
    this.setState({data: this.state.data});
  },
  edit: function (index, content) {
    this.state.data[index] = content;
    this.setState({data: this.state.data});
  },
  render: function() {
    var self = this;
    var todoNodes = this.state.data.map(function (item, index) {
      return (
        <TodoItem content={item} remove={self.remove} index={index} />
      );
    });
    var result;
    if (this.state.data.length > 0) {
      result = <ul>{todoNodes}</ul>;
    } else {
      result = <ul><li style={{textAlign: 'center'}}><a>您没有待办事项</a></li></ul>;
    }
    return (
      <div>
        {result}
        <TodoBox add={this.add} />
      </div>
    );
  }
});

var TodoBox = React.createClass({
  add: function () {
    var e = window.event;
    // check if "enter" pressed
    if (e.keyCode == 13 || e.which == 13) {
      var text = this.getDOMNode().childNodes[0];
      this.props.add.call(this, text.value);
      text.value = '';
    }
  },
  render: function () {
    return (
      <div className={'inputWrapper'}><input className={'inputbox'} onKeyDown={this.add} /></div>
    );
  }
});

React.render(<TodoList />, document.getElementById('todo-list'));
</script>
</html>
